机器人上的主控芯片是STM32F4系列，编程语言是C语言。

在机器人的硬件代码文件夹中，通过project目录下的SSL_Ctrl_v13.uvprojx打开工程文件。打开之后会看到如下目录，我们主要先关注src文件夹下的，其他大多是一些库。

![figure1](uploads/89a194d7dd8ec565ece025463d59a96a/figure1.png)

先大概介绍各个文件的基本作用，有些文件非常复杂，但是大家并不需要都看懂，按需查看就行，有兴趣的同学可以深入了解。

## nrf24l01.c\nrf24l01_drv.c
这两个文件基本是用来驱动和控制nrf24l01芯片的。nrf24L01是一个无线模块，发射机发送给机器人的指令就是通过这个模块来接收的。

## packet.c
主要处理接收到的数据包，包括解码数据包格式并把相关指令转换成对应的控制变量等。

## param.c
用于初始化机器人参数，例如PID参数、最大射门力度等。可以发现里面有几个宏MOTOR_PID_KP、MOTOR_PID_KI、MOTOR_PID_KD等，这就是PID的参数，定义在cfg.h中，我们后面改PID参数就在这里面修改。

## pid.c
实现了PID算法。

## robot.c
这个是控制机器人的关键程序，包含几个函数。
int init_robot(void)做一些初始化机器人的操作，主要还是调用底层的一些函数。
int do_power_monitor(void)每调用一次便检测一次电容的电压。
void do_timer()进行计数，计数达到一定值后便调用一次PID控制算法并更新电机控制量。
void do_run(void)是一个循环程序。板子上电并执行一些初始化程序之后，便进入一个循环程序。可以发现do_run里面会有一个while(1)，里面会根据当前机器人的模式，不断接受外部指令，然后做出相应的操作。
void SysTick_Handler(void)是一个系统时钟中断服务程序。函数内部执行看门狗的喂狗操作、更新一个计时的变量sys_tick（加1）、并且执行一次do_timer()。sys_tick这个变量在其他很多地方都用到了，可以理解为用来获取当前系统的时间，这样方便每隔一段时间做相应的事情。

## system_stm32f4xx.c
比较底层的配置文件，可以不用管。

## timer.c
一些定时器的操作，包括延迟函数、获取当前系统时间的函数（其实就是获取sys_tick变量）的值。get_one_timer(u32 time)和check_timer(timer_t timer)是一个软件实现的定时器。
## Usart_ble.c
与蓝牙操作相关的一些函数，目前没有用到蓝牙控制，可以先不用管。

## action.c
实现了机器人操作相关的一些函数，比如射门、运动、吸球等动作。最终是通过int on_robot_command( packet_robot_t *packet )或者int do_robot_command( packet_robot_t *packet )这两个函数来根据指令包的要求调用相关的动作的。

## comm.c
实现了通信数据处理，包括蓝牙模块、nrf24L01模块、手柄等。

## gpio.c
主要是看门狗初始化、GPIO（通用输入输出接口）的初始化，涉及到比较底层的配置，按F12追踪后可以看到一些直接配置寄存器的操作，可能要结合芯片的数据手册、板子的电路图等才能看懂。

## Hm_bluetooth.c
实现了一些设置蓝牙模块的函数。

## i2c.c
实现了一些i2c操作的函数，主要是用于读写EEPROM、控制陀螺仪MPU6050等。

## init.c
一些机器人的初始化功能。其中可以重点关注int do_init(void)，里面调用了几个函数，分别负责初始化系统时钟、中断设置、GPIO、系统滴答时钟等，最后初始化整个系统。推荐从int do_init(void)开始层层深入看代码。

## main.c
整个程序的入口。main函数中只调用了两个函数，do_init()用于初始化，do_run()则不断循环，前面有说明。

## misc.c
一些比较偏向底层操作的函数，比较杂。基本是采样电池电压值、采样电容电压值、读取编码器、设置PWM这些。这些函数会被上层的踢球等操作调用。

## motor.c
与电机控制相关的一些操作，比如读取编码器、设置PWM等，也是比较偏向底层的。

## usb开头的一些文件
是来自ST官方提供的usb驱动库，手柄模式时会用到usb接口。